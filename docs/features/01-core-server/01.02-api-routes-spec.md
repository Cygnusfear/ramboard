# 01.02 API Routes

> **Feature Area:** [[../README|01-Core-Server]]
> **Feature ID:** 01.02

## Behavior

### Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/api/projects` | List configured projects (id, name, ticket count) |
| GET | `/api/projects/:id/tickets` | All tickets for a project. Query params: `status`, `priority`, `tag`, `sort` |
| GET | `/api/projects/:id/tickets/:tid` | Single ticket with full markdown body |
| PATCH | `/api/projects/:id/tickets/:tid` | Update ticket metadata (status, priority, tags) |
| POST | `/api/projects/:id/tickets/:tid/checkbox` | Toggle a markdown checkbox by index |

### Write Operations

PATCH updates YAML frontmatter in the `.tickets/*.md` file directly. For status changes, also shells out to `tk` CLI to keep its index in sync:
- `open → in_progress`: `tk start <id>`
- `* → closed`: `tk close <id>`
- `closed → open`: `tk reopen <id>`

### Error Handling
- Unknown project → 404 `{ error: "project not found" }`
- Unknown ticket → 404 `{ error: "ticket not found" }`
- Invalid PATCH body → 400 with validation details
- tk command failure → 500 with stderr

## Decisions

### ADR-1: Shell out to tk for status changes
- **Status:** Accepted
- **Context:** tk maintains its own index. Writing frontmatter alone would desync.
- **Decision:** PATCH handler writes frontmatter AND runs tk CLI command.
- **Consequences:** Depends on tk being installed. Slightly slower writes (~50ms). Guaranteed consistency.
