# Mid-mortem: Ramboard session â€” filters, routing, perf, Base UI migration

**Type:** task | **Priority:** 3 | **Tags:** mid-mortem, compaction
**Created:** 2026-02-23

---
status: closed

## What Was Being Worked On

**Ramboard** â€” a multi-project ticket dashboard (Linear-style) for viewing `.tickets/` across all local projects. Stack: React 19 + Vite 7 + Bun + Tailwind 4 + wouter + TanStack Virtual + Base UI.

The session started from a blank-screen app (infinite render loop) and built it up to a functional Linear-quality board with routing, composite filters, virtualized lists, and a CLI tool.

### Goal
Get Ramboard from broken â†’ production-quality ticket dashboard with all the Linear niceties.

---

## Decisions Made

1. **Zustand selector trap fix** â€” `filteredTickets()` was called inside a Zustand selector, creating a new array every render â†’ infinite loop in React 19. Fix: extracted filtering into a pure function (`src/lib/filter-engine.ts`) consumed by a `useFilteredTickets()` hook with `useMemo`. Keyboard handler uses the same pure function via `getState()`.

2. **Wouter for routing** â€” URL-driven navigation (`/:projectId`, `/:projectId/ticket/:ticketId`). Mouse back/forward works natively via browser history. No custom mouse event hacks needed.

3. **Composite filter engine** â€” Pure function architecture in `src/lib/filter-engine.ts`. Filter types: `is_any_of`, `is_none_of`, `contains`, `before`, `after`, `between`, `last_n_days`. Fields: status, priority, type, tag, assignee, created, title. All filters AND together. Default filter: Status is any of [Open, In Progress].

4. **Filter state separated from ticket store** â€” `src/stores/filter-store.ts` owns filter + sort state. Ticket store only owns fetched data + active ticket.

5. **List virtualization** â€” `@tanstack/react-virtual` with fixed 36px row height. Only ~30 rows in DOM at any time. Critical for Trek's 1300+ tickets.

6. **Scroll jank elimination** â€” Five compounding issues fixed:
   - Removed `measureElement` (forced reflows) â†’ fixed `h-9` CSS height
   - Added scroll-detection flag that suppresses `onMouseEnter` highlights for 100ms after scroll
   - Replaced per-row CSS transitions with pure CSS `.list-row:hover` (GPU-composited)
   - Single event delegation handler on container via `data-index` instead of arrow functions per row
   - `React.memo` on `ListRow`

7. **Persistent config** â€” `~/.ramboard/config.json` stores project list. No more hardcoded paths. Server reads config live (no restart on add/remove).

8. **`board` CLI** â€” `bin/board.ts` installed globally at `/usr/local/bin/board`. Commands: `board` (auto-add cwd + start + open browser), `board ls`, `board add <path>`, `board rm <id>`, `board server`.

9. **Base UI + cmdk adopted** â€” `@base-ui/react` for headless primitives (buttons, toggles, selects, popovers). `cmdk` for command palette. Installed and initial migration committed (`318a075`).

10. **Drag-to-select** â€” Pure state machine in `src/lib/drag-select.ts`. Supports click, shift+click range, cmd/ctrl+click toggle, drag with threshold. Selection syncs index-based â†’ ID-based for bulk actions.

---

## Progress

### âœ… Done
- [x] Fix infinite render loop (Zustand selector trap)
- [x] Wouter routing with URL state
- [x] Composite filter engine + filter bar UI
- [x] Linear-quality list view with drag-select
- [x] Virtualized list (@tanstack/react-virtual)
- [x] Scroll jank elimination (5 sources fixed)
- [x] `board` CLI + `~/.ramboard/` persistent config
- [x] 2-letter sidebar abbreviations
- [x] Filter dropdown z-index fix
- [x] Default status filter (hide closed/cancelled)
- [x] @tailwindcss/typography for markdown prose rendering
- [x] Base UI + cmdk installed and initial migration committed

### ðŸŸ¡ Partially Done / Just Started
- [ ] **Base UI migration** â€” installed and initial commit made (`318a075 feat(ui): migrate to Base UI + cmdk`), but the user was asking about it right at session end. May need more components migrated (toggles mentioned specifically). Check the diff of that commit to see what was covered.

---

## Open Threads

1. **Base UI completeness** â€” User explicitly asked "are you using BaseUI for EVERYTHING like buttons, input etc, toggles". The migration commit exists but verify ALL hand-rolled components are replaced: filter dropdowns, status cycling, toggle switches, modals, popovers.

2. **Board view** â€” `src/components/board-view.tsx` uses `@dnd-kit/core` for drag-and-drop Kanban. Hasn't been touched this session â€” may need same perf treatment as list view. Also needs Base UI components.

3. **Bulk action bar** â€” `src/components/bulk-action-bar.tsx` exists for multi-select actions but wasn't polished this session.

4. **Command palette** â€” `src/components/command-palette.tsx` â€” may have been migrated to `cmdk` in the Base UI commit, verify.

5. **Server has no static file serving** â€” Vite dev server serves the frontend. For production, the Bun server needs to serve built assets or a reverse proxy is needed.

---

## Gotchas & Learnings

1. **React 19 + Zustand selector trap** â€” NEVER call a function that returns a new array/object inside a Zustand selector. `useStore(s => s.computed())` creates infinite loops. Use `useMemo` in a custom hook instead.

2. **Tailwind v4 preflight kills prose** â€” `prose` classes do nothing without `@tailwindcss/typography`. In Tailwind v4, import it in CSS: `@import "tailwindcss"; @plugin "@tailwindcss/typography";`

3. **`overflow-hidden` on flex parents clips dropdowns** â€” Filter bar dropdowns were invisible because the parent flex column had `overflow-hidden`. Fix: only clip the scroll container (list), not the parent.

4. **TanStack Virtual `measureElement` causes jank** â€” Dynamic measurement via `getBoundingClientRect()` forces reflows during scroll. If rows can be fixed-height, use a constant `estimateSize` and skip measurement entirely.

5. **Event delegation > per-row handlers for virtualized lists** â€” One handler on the container reading `data-index` from `event.target.closest('[data-index]')` is dramatically faster than N arrow functions on N rows.

6. **Scroll suppresses mouse highlights** â€” During fast scrolling, `onMouseEnter` fires on rows passing under the cursor. This triggers zustand updates â†’ re-renders â†’ jank. Fix: set a flag on scroll events, clear it 100ms after scroll stops.

---

## Architecture (for next agent)

```
~/.ramboard/config.json          â€” project list (source of truth)
bin/board.ts                     â€” CLI entry point
server/config.ts                 â€” reads/writes ~/.ramboard/config.json
server/index.ts                  â€” Bun.serve() on :4000
server/routes.ts                 â€” REST API (projects, tickets, config)
server/ticket-parser.ts          â€” parses .tickets/*.md files
server/ticket-writer.ts          â€” updates ticket files

src/app.tsx                      â€” wouter Router, route definitions
src/stores/ticket-store.ts       â€” ticket data (fetch, update)
src/stores/filter-store.ts       â€” filter + sort state
src/stores/project-store.ts      â€” project list + active project
src/stores/ui-store.ts           â€” view mode, selection, highlight

src/lib/filter-engine.ts         â€” pure filter/sort functions
src/lib/drag-select.ts           â€” pure drag-select state machine
src/lib/types.ts                 â€” shared types

src/hooks/use-filtered-tickets.ts â€” memoized filtered ticket list
src/hooks/use-keyboard.ts         â€” keyboard + mouse shortcuts
```

**Ports:** API `:4000`, Vite `:4001`

**Git:** 10 commits on `main`, all clean. Latest: `a172d40`.
