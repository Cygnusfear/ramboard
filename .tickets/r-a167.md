---
id: r-a167
status: closed
deps: []
links: []
created: 2026-03-01T12:05:09Z
type: task
priority: 2
assignee: t2-hooks
tags: [team]
---
# Working directory: /Users/alexander/Projects/ramboard/.worktrees/t2-hooks

Read AGENTS.md first. Then read each file you modify BEFORE editing.

You have 2 tasks — both extract hooks from inline code.

## T2-02: Extract `allTags` to `src/hooks/use-all-tags.ts`

Two components compute the same `allTags` with identical `useMemo`:
- `src/components/ticket-context-menu.tsx` (~lines 92-98)
- `src/components/tag-editor.tsx` (~lines 29-34)

Both do something like:
```typescript
const allTags = useMemo(() => {
  const set = new Set<string>()
  tickets.forEach(t => t.tags?.forEach(tag => set.add(tag)))
  return [...set].sort()
}, [tickets])
```

### What to do:
1. Create `src/hooks/use-all-tags.ts`:
   ```typescript
   import { useMemo } from 'react'
   import { useTicketStore } from '@/stores/ticket-store'

   /** All unique tags across all tickets in the current project, sorted. */
   export function useAllTags(): string[] {
     const tickets = useTicketStore(s => s.tickets)
     return useMemo(() => {
       const set = new Set<string>()
       tickets.forEach(t => t.tags?.forEach(tag => set.add(tag)))
       return [...set].sort()
     }, [tickets])
   }
   ```
2. In `ticket-context-menu.tsx`: replace the inline `allTags` useMemo with `const allTags = useAllTags()`. Remove the now-unused `tickets` subscription if it was only used for allTags.
3. In `tag-editor.tsx`: same — replace inline computation with `useAllTags()`. Remove unused tickets subscription.

## T2-05: Extract `useProjectViewSetup` from `app.tsx` to `src/hooks/use-project-view-setup.ts`

`src/app.tsx` defines `useProjectViewSetup` inline (lines 30-75). It's a complex hook with 4 effects mixing: activeTicket clear, data fetch, URL viewId sync, and saved view filter loading.

### What to do:
1. Create `src/hooks/use-project-view-setup.ts`
2. Move the entire `useProjectViewSetup` function there (cut from app.tsx, paste to new file)
3. Add all necessary imports to the new file
4. In `app.tsx`: `import { useProjectViewSetup } from '@/hooks/use-project-view-setup'`
5. Remove the now-unused imports from app.tsx that were only needed for the hook

This is a pure move — no logic changes. The hook signature stays the same: `useProjectViewSetup(projectId: string | null, viewId: string | null)`.

After both:
1. Verify: `cd /Users/alexander/Projects/ramboard/.worktrees/t2-hooks && npx tsc --noEmit 2>&1 | grep -v server/`
2. Commit: `git add -A && git commit -m 'refactor: extract useAllTags and useProjectViewSetup hooks'`
3. Report what you did.

Working directory: /Users/alexander/Projects/ramboard/.worktrees/t2-hooks

Read AGENTS.md first. Then read each file you modify BEFORE editing.

You have 2 tasks — both extract hooks from inline code.

## T2-02: Extract `allTags` to `src/hooks/use-all-tags.ts`

Two components compute the same `allTags` with identical `useMemo`:
- `src/components/ticket-context-menu.tsx` (~lines 92-98)
- `src/components/tag-editor.tsx` (~lines 29-34)

Both do something like:
```typescript
const allTags = useMemo(() => {
  const set = new Set<string>()
  tickets.forEach(t => t.tags?.forEach(tag => set.add(tag)))
  return [...set].sort()
}, [tickets])
```

### What to do:
1. Create `src/hooks/use-all-tags.ts`:
   ```typescript
   import { useMemo } from 'react'
   import { useTicketStore } from '@/stores/ticket-store'

   /** All unique tags across all tickets in the current project, sorted. */
   export function useAllTags(): string[] {
     const tickets = useTicketStore(s => s.tickets)
     return useMemo(() => {
       const set = new Set<string>()
       tickets.forEach(t => t.tags?.forEach(tag => set.add(tag)))
       return [...set].sort()
     }, [tickets])
   }
   ```
2. In `ticket-context-menu.tsx`: replace the inline `allTags` useMemo with `const allTags = useAllTags()`. Remove the now-unused `tickets` subscription if it was only used for allTags.
3. In `tag-editor.tsx`: same — replace inline computation with `useAllTags()`. Remove unused tickets subscription.

## T2-05: Extract `useProjectViewSetup` from `app.tsx` to `src/hooks/use-project-view-setup.ts`

`src/app.tsx` defines `useProjectViewSetup` inline (lines 30-75). It's a complex hook with 4 effects mixing: activeTicket clear, data fetch, URL viewId sync, and saved view filter loading.

### What to do:
1. Create `src/hooks/use-project-view-setup.ts`
2. Move the entire `useProjectViewSetup` function there (cut from app.tsx, paste to new file)
3. Add all necessary imports to the new file
4. In `app.tsx`: `import { useProjectViewSetup } from '@/hooks/use-project-view-setup'`
5. Remove the now-unused imports from app.tsx that were only needed for the hook

This is a pure move — no logic changes. The hook signature stays the same: `useProjectViewSetup(projectId: string | null, viewId: string | null)`.

After both:
1. Verify: `cd /Users/alexander/Projects/ramboard/.worktrees/t2-hooks && npx tsc --noEmit 2>&1 | grep -v server/`
2. Commit: `git add -A && git commit -m 'refactor: extract useAllTags and useProjectViewSetup hooks'`
3. Report what you did.


## Notes

**2026-03-01T12:05:22Z**

Starting work on T2-02 (useAllTags hook) and T2-05 (useProjectViewSetup hook extraction). Reading AGENTS.md and relevant files first.

**2026-03-01T12:07:04Z**

DONE: Extracted two hooks and updated consumers.

**T2-02 — useAllTags:**
- Created `src/hooks/use-all-tags.ts` with `useAllTags()` that reads from `useTicketStore(s => s.tickets)` and returns sorted unique tags
- `ticket-context-menu.tsx`: replaced inline allTickets subscription + useMemo with `useAllTags()`
- `tag-editor.tsx`: replaced inline tickets subscription + useMemo with `useAllTags()`, removed unused `useTicketStore` import

**T2-05 — useProjectViewSetup:**
- Created `src/hooks/use-project-view-setup.ts` with full hook moved from app.tsx (pure cut-paste, zero logic changes)
- `app.tsx`: added import, removed inline function, removed now-unused `useViewStore`, `useFilterStore`, `useUIStore`, and `useLocation` imports

TypeScript check: clean (no errors). Committed as `090fa04`.

**2026-03-01T12:07:10Z**

DONE: Task completed.
