---
id: r-9c37
status: closed
deps: []
links: []
created: 2026-03-01T12:13:16Z
type: task
priority: 2
assignee: t3-extractions
tags: [team]
---
# Working directory: /Users/alexander/Projects/ramboard/.worktrees/t3-extractions

Read AGENTS.md first. You have 3 independent tasks touching completely different files.

## T3-02: Push dirty tracking out of filter-store

### The Problem
`src/stores/filter-store.ts` has a `notifyDirty()` function that uses dynamic import to avoid circular deps:
```typescript
function notifyDirty() {
  import('@/stores/view-store').then(m => m.useViewStore.getState().markDirty())
}
```
This hides the filter-store → view-store coupling from static analysis.

### The Fix
1. Delete `notifyDirty()` from `filter-store.ts` and remove ALL calls to it (in addFilter, updateFilter, removeFilter, clearFilters, setSearch, setSort).
2. In `src/hooks/use-project-view-setup.ts`, add a Zustand subscription that marks view dirty when filter state changes:
   ```typescript
   // At the top of the hook, subscribe to filter changes → mark view dirty
   useEffect(() => {
     const unsub = useFilterStore.subscribe(() => {
       useViewStore.getState().markDirty()
     })
     return unsub
   }, [])
   ```
   Import `useFilterStore` and `useViewStore` if not already imported.
3. This moves the cross-store coupling to the orchestration layer (the setup hook) where it's visible and explicit.

## T3-04: Extract `computeLayout` to `src/lib/graph-layout.ts`

### The Problem
`computeLayout()` in `src/components/graph-view.tsx` (around lines 38-90) is a pure function. It takes `TicketSummary[]`, uses dagre, returns `GraphLayout`. Zero React dependency. It belongs in `lib/`.

### The Fix
1. Create `src/lib/graph-layout.ts`
2. Move `computeLayout`, `GraphLayout`, `LayoutNode`, `LayoutEdge`, `NODE_WIDTH`, `NODE_HEIGHT`, `PADDING` interfaces/constants from `graph-view.tsx` to the new file.
3. Export them from `graph-layout.ts`.
4. In `graph-view.tsx`: import `{ computeLayout, type GraphLayout, type LayoutNode, type LayoutEdge, NODE_WIDTH, NODE_HEIGHT }` from `@/lib/graph-layout`.
5. Delete the moved code from `graph-view.tsx`.

## T3-05: Extract `BoardToolbar` to `src/components/board-toolbar.tsx`

### The Problem
`BoardToolbar` (lines ~77-173 in `board-view.tsx`) is a complete, self-contained component defined inline in `board-view.tsx`. It should be its own file.

### The Fix
1. Create `src/components/board-toolbar.tsx`
2. Move `BoardToolbar` function and its props type there. Also move the `PRESETS` array and `PresetDef` type (they're only used by the toolbar).
3. Add all necessary imports to the new file.
4. In `board-view.tsx`: `import { BoardToolbar } from './board-toolbar'`. Remove the moved code and any imports that were only used by the toolbar.
5. `board-view.tsx` still needs to pass `view`, `onApplyPreset`, `onToggleBoardSort`, `onSetBoardSortField` as props.

After all 3:
1. Verify: `cd /Users/alexander/Projects/ramboard/.worktrees/t3-extractions && npx tsc --noEmit 2>&1 | grep -v server/`
2. Commit: `git add -A && git commit -m 'refactor: push dirty tracking to hook, extract graph-layout and board-toolbar'`
3. Report what you did with file-level detail.

Working directory: /Users/alexander/Projects/ramboard/.worktrees/t3-extractions

Read AGENTS.md first. You have 3 independent tasks touching completely different files.

## T3-02: Push dirty tracking out of filter-store

### The Problem
`src/stores/filter-store.ts` has a `notifyDirty()` function that uses dynamic import to avoid circular deps:
```typescript
function notifyDirty() {
  import('@/stores/view-store').then(m => m.useViewStore.getState().markDirty())
}
```
This hides the filter-store → view-store coupling from static analysis.

### The Fix
1. Delete `notifyDirty()` from `filter-store.ts` and remove ALL calls to it (in addFilter, updateFilter, removeFilter, clearFilters, setSearch, setSort).
2. In `src/hooks/use-project-view-setup.ts`, add a Zustand subscription that marks view dirty when filter state changes:
   ```typescript
   // At the top of the hook, subscribe to filter changes → mark view dirty
   useEffect(() => {
     const unsub = useFilterStore.subscribe(() => {
       useViewStore.getState().markDirty()
     })
     return unsub
   }, [])
   ```
   Import `useFilterStore` and `useViewStore` if not already imported.
3. This moves the cross-store coupling to the orchestration layer (the setup hook) where it's visible and explicit.

## T3-04: Extract `computeLayout` to `src/lib/graph-layout.ts`

### The Problem
`computeLayout()` in `src/components/graph-view.tsx` (around lines 38-90) is a pure function. It takes `TicketSummary[]`, uses dagre, returns `GraphLayout`. Zero React dependency. It belongs in `lib/`.

### The Fix
1. Create `src/lib/graph-layout.ts`
2. Move `computeLayout`, `GraphLayout`, `LayoutNode`, `LayoutEdge`, `NODE_WIDTH`, `NODE_HEIGHT`, `PADDING` interfaces/constants from `graph-view.tsx` to the new file.
3. Export them from `graph-layout.ts`.
4. In `graph-view.tsx`: import `{ computeLayout, type GraphLayout, type LayoutNode, type LayoutEdge, NODE_WIDTH, NODE_HEIGHT }` from `@/lib/graph-layout`.
5. Delete the moved code from `graph-view.tsx`.

## T3-05: Extract `BoardToolbar` to `src/components/board-toolbar.tsx`

### The Problem
`BoardToolbar` (lines ~77-173 in `board-view.tsx`) is a complete, self-contained component defined inline in `board-view.tsx`. It should be its own file.

### The Fix
1. Create `src/components/board-toolbar.tsx`
2. Move `BoardToolbar` function and its props type there. Also move the `PRESETS` array and `PresetDef` type (they're only used by the toolbar).
3. Add all necessary imports to the new file.
4. In `board-view.tsx`: `import { BoardToolbar } from './board-toolbar'`. Remove the moved code and any imports that were only used by the toolbar.
5. `board-view.tsx` still needs to pass `view`, `onApplyPreset`, `onToggleBoardSort`, `onSetBoardSortField` as props.

After all 3:
1. Verify: `cd /Users/alexander/Projects/ramboard/.worktrees/t3-extractions && npx tsc --noEmit 2>&1 | grep -v server/`
2. Commit: `git add -A && git commit -m 'refactor: push dirty tracking to hook, extract graph-layout and board-toolbar'`
3. Report what you did with file-level detail.


## Notes

**2026-03-01T12:15:32Z**

Starting work on 3 tasks: T3-02 (filter-store dirty tracking), T3-04 (graph-layout extraction), T3-05 (BoardToolbar extraction). Files examined, plan clear.

**2026-03-01T12:18:45Z**

DONE: All 3 tasks complete, tsc --noEmit passes clean.

T3-02: Deleted notifyDirty() and all 6 call sites from filter-store.ts. Added useEffect subscription in use-project-view-setup.ts that calls useViewStore.getState().markDirty() on any filter state change — moves the cross-store coupling to the orchestration layer where it's visible.

T3-04: Created src/lib/graph-layout.ts with exported LayoutNode, LayoutEdge, GraphLayout interfaces + NODE_WIDTH, NODE_HEIGHT, PADDING constants + computeLayout() function. Removed dagre import and all moved code from graph-view.tsx, added import from @/lib/graph-layout.

T3-05: Created src/components/board-toolbar.tsx with exported PresetDef interface, PRESETS array, and BoardToolbar component. Removed all toolbar-only code from board-view.tsx (PresetId, PresetDef, PRESETS, BoardToolbar, and 4 imports: STATUS_LABELS/PRIORITY_LABELS/SORT_FIELD_OPTIONS, SortAscending/SortDescending/Lightning/Check, Popover, SortDir). Added import of BoardToolbar and type PresetDef from ./board-toolbar.

Commit: 4e9dc8c

**2026-03-01T12:18:57Z**

DONE: Task completed.
