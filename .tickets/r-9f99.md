---
id: r-9f99
status: in_progress
deps: []
links: [r-db91]
created: 2026-03-01T12:27:35Z
type: feature
priority: 2
assignee: Alexander Mangel
tags: [frontend, routing, architecture]
---
# Proper router integration — view-based routing, kill filter-url-sync

Current routing is a patchwork:\n\n## Problems\n\n1. **`use-filter-url-sync.ts` fights view-based routing.** It serializes filter JSON to URL query params (`?f=[{...}]&sf=created`), but saved views already store filters server-side. The two systems fight each other — the setup hook checks `hasUrlFilters` to decide which source wins.\n\n2. **Duplicate route components.** `ProjectView` and `ProjectViewWithViewId` in `app.tsx` are nearly identical — both call `useProjectViewSetup(projectId, viewId)`, one passes `null` for viewId. Should be one component.\n\n3. **No route-based data loading.** Data fetching is triggered by `useEffect` chains in `useProjectViewSetup`. The route change triggers re-render → effect fires → fetch → re-render with data. This creates the loading flash.\n\n4. **View transitions are manually orchestrated.** `use-navigate.ts` wraps wouter's navigate with `document.startViewTransition()`. This works but is fragile — any direct `navigate()` call bypasses transitions.\n\n## Current wouter usage\n- `app.tsx`: Route, Switch, Redirect, useRoute (4 routes)\n- `use-filter-url-sync.ts`: useSearch, useLocation (URL param sync)\n- `use-navigate.ts`: useLocation (wrapped with View Transitions)\n\n## Target architecture\n- **View-based URLs**: `/<project>`, `/<project>/view/<viewId>`, `/<project>/ticket/<ticketId>` (see r-db91)\n- **Delete `use-filter-url-sync.ts` entirely.** Filter state lives in saved views, not URL params.\n- **Single `ProjectView` component** that reads both projectId and optional viewId from route params\n- **Route-based data loading**: consider wouter's data loading patterns or a lightweight loader wrapper\n- **View Transitions**: keep the `use-navigate.ts` wrapper but document that all navigation must go through it\n\n## Files to touch\n- `src/hooks/use-filter-url-sync.ts` — DELETE\n- `src/app.tsx` — consolidate route components, remove useFilterUrlSync call\n- `src/hooks/use-project-view-setup.ts` — remove `hasUrlFilters` check, simplify\n- `src/hooks/use-navigate.ts` — review, possibly simplify\n\n## Depends on\n- r-db91 (clean URL structure) — closely related, may be implemented together



## Goal
Single coherent routing layer. Filter state lives in views, not URLs. One route component per pattern. No fighting between URL sync and view-based loading.

## Acceptance Criteria
- [ ] use-filter-url-sync.ts deleted
- [ ] Single ProjectView component handles both /:projectId and /:projectId/view/:viewId
- [ ] No JSON-encoded filter params in URLs
- [ ] View transitions still work on all navigation
- [ ] Back/forward browser navigation works correctly
- [ ] Switching views updates URL to /<project>/view/<viewId>

## Verification
- [ ] TODO

## Worktree
- .
